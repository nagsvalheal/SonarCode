<!-- This component is used to display all following users of the logged User and the user can unFollow Users.-->
<!-- Strings are hard coded in this HTML file to comply with the mobile responsiveness-->
<template>
  <!-- To display ToastMessage for UnFollowing the User  -->
  <template if:true={showToastForUnFollow}>
    <button
      class="toastmsgclose"
      title="Close"
      onclick={closeUnfollowToastMessage}
    >
      X
    </button>
    <div class="toastmsg">
      <img src={ticIcon} class="imgsize" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p class="flwtoastmsg">You unfollowed {selectedUser} successfully.</p>
    </div>
  </template>
  <div class="total">
    <!-- leftSide Avatar content -->
    <div class="backgroundtop">
      <img src={loggedUserAvatar} class="avatarno" />
      <div class="avatarcontentno">
        <div>
          <p class="avatarcontentdis">
            This is the patient community forum! Create posts, react and
            comment, connect with others and build a supportive community in
            your health journey.
          </p>
        </div>
      </div>
      <!-- This line is only for mobile responsiveness -->
      <hr class="forMblresponse" />
    </div>
    <!-- Toast Message for Mobile responsivenss for Unfollow -->
    <template if:true={showToastForUnFollow}>
      <button
        class="toastmsgcloseformbl"
        title="Close"
        onclick={closeUnfollowToastMessage}
      >
        X
      </button>
      <div class="toastmsgforMbl">
        <img src={ticIcon} class="tickimage" />
        <div class="classflex">
          <p class="para">You unfollowed {selectedUser} successfully.</p>
        </div>
      </div>
    </template>
    <!-- right side content -->
    <div class="rightSide">
      <p class="title" data-scroll-target>Following ({numberOfFollowings})</p>
      <!-- Total following count -->
      <!-- display this content if there are following list for the logged user -->
      <template if:true={followingsCount}>
        <!-- User Avatar,Username and Following button -->
        <template for:each={userNames} for:item="username">
          <div class="divclass" key={username.Id}>
            <div class="avatarAndName">
              <img
                src={username.userAvatarForEnrollee}
                class="profileavatar"
                onclick={handleFollowButtonClick}
                data-id={username}
                data-avatar={username.userAvatarForEnrollee}
                data-username={username.BI_PSP_CareProgramEnrolleeFollow__r.BI_PSP_CommunityUsername__c}
                data-enrollee={username.BI_PSP_CareProgramEnrolleeFollow__r.Id}
                data-following={username.followOrUnFollowButton}
                data-it-button="MyFollowers: Profile Avatar"
              />
              <p
                class="name"
                onclick={handleFollowButtonClick}
                data-avatar={username.userAvatarForEnrollee}
                data-id={username}
                data-username={username.BI_PSP_CareProgramEnrolleeFollow__r.BI_PSP_CommunityUsername__c}
                data-enrollee={username.BI_PSP_CareProgramEnrolleeFollow__r.Id}
                data-following={username.followOrUnFollowButton}
                data-it-button="MyFollowers: Profile Username"
              >
                {username.BI_PSP_CareProgramEnrolleeFollow__r.BI_PSP_CommunityUsername__c}
              </p>
            </div>
            <button
              class={username.followOrUnFollowButton}
              onclick={handleFollowProfileButton}
              data-avatar={username.userAvatarForEnrollee}
              data-id={username}
              data-username={username.BI_PSP_CareProgramEnrolleeFollow__r.BI_PSP_CommunityUsername__c}
              data-enrollee={username.BI_PSP_CareProgramEnrolleeFollow__r.Id}
              data-following={username.followOrUnFollowButton}
              data-it-button="MyFollowers: Follow/Unfollow "
            >
              {username.followOrUnFollowButton}
            </button>
          </div>
        </template>
      </template>
      <!-- If there are no following list display this content -->
      <template if:false={followingsCount}>
        <div class="widthformbl">
          <img src={allPostImg} class="postimage" />
          <p class="text">
            You are not following anyone yet! Get connected! Following other
            users is a great way to stay connected with other patients who share
            your interests.
          </p>
          <br />
        </div>
      </template>
      <!-- Display the profile popup when user click the following button  -->
      <template if:true={following}>
        <template if:true={followingPopup}>
          <div class="back">
            <div class="popup-container">
              <p class="profile">Profile</p>
              <button
                onclick={closePopup}
                class="times"
                data-it-button="MyFollowers: Close Follow"
              >
                X
              </button>
              <div class="picname">
                <img
                  src={avatarFollow}
                  class="popavatar"
                  data-it-button="MyFollowers: Profile Avatar"
                />
                <p class="username">{selectedUser}</p>
              </div>
              <button
                class="popupbuttonFollowing"
                onclick={handleFollowingPopupButtonClick}
                data-it-button="MyFollowers: Following"
              >
                Following
              </button>
            </div>
          </div>
        </template>
      </template>
      <!-- UnFollow confirmation popup -->
      <template if:true={followingPopupConfirmation}>
        <div class="back">
          <div class="popup2-container">
            <button
              onclick={closePopup}
              data-it-button="MyFollowers: Close Popup"
              class="times2"
            >
              X
            </button>
            <p class="popuptitle second">Unfollow User?<br /></p>
            <p class="popupcontent">
              Are you sure you want to unfollow {selectedUser}?<br /><br />
            </p>
            <p class="contentonly">
              You'll no longer receive notifications whenever this user creates
              a new post.
            </p>
            <button
              class="followno1 second"
              onclick={closePopup}
              data-it-button="MyFollowers: Unfollow No "
            >
              No
            </button>
            <button
              class="followyes1"
              onclick={handleUnFollowConfirmation}
              data-it-button="MyFollowers: Unfollow Yes "
            >
              Yes
            </button>
          </div>
        </div>
      </template>
      <!-- Loading spinner -->
      <div if:true={isLoading}>
        <lightning-spinner
          alternative-text="Loading"
          class="spinner-container"
        ></lightning-spinner>
      </div>
    </div>
  </div>
</template>